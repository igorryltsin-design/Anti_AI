# AntiAI (AI Text Purifier)

Веб‑приложение для локальной очистки текста и `.docx` от «мусора» и типичных артефактов генеративного ИИ: скрытых/невидимых символов, типографики, повторов, клише‑фраз, «воды», странной структуры. Работает прямо в браузере; сервер не нужен.

## Содержание

- [Возможности](#возможности)
- [Уровни очистки](#уровни-очистки)
- [Быстрый старт (разработка)](#быстрый-старт-разработка)
- [Сборка и предпросмотр](#сборка-и-предпросмотр)
- [Docker (прод)](#docker-прод)
- [Развёртывание без Docker](#развёртывание-без-docker)
- [Как это работает (в общих чертах)](#как-это-работает-в-общих-чертах)
- [Использование](#использование)
- [Настройки и паттерны](#настройки-и-паттерны)
- [LM Studio (опционально)](#lm-studio-опционально)
- [Траблшутинг](#траблшутинг)
- [Приватность и безопасность](#приватность-и-безопасность)
- [Структура проекта](#структура-проекта)
- [Разработка](#разработка)
- [Лицензия](#лицензия)

## Возможности

- Редактор текста с подсветкой подозрительных фрагментов (по паттернам), фильтрами и быстрым переходом между найденными местами.
- Очистка по уровням: базовая, структура, AI‑паттерны, humanizer (экспериментально).
- Детальные настройки: кавычки (`" → «»` или `«» → "`), тире (`—/–/-`), пробелы/строки/списки, «висячие предлоги» (NBSP), удаление ссылок/емейлов/эмодзи, консервативное удаление декоративного мусора.
- Работа с Word `.docx`: импорт, редактирование (включая таблицы), экспорт обратно в `.docx`.
- Пакетная обработка нескольких `.docx` с выгрузкой результатов одним архивом `.zip`.
- Режим сравнения (diff) и «мягкие правки» (preview) для некоторых AI‑паттернов.
- Опциональная интеграция с LM Studio (OpenAI‑совместимый API) для очистки/нормализации больших текстов чанками.

## Уровни очистки

Переключатели в настройках соответствуют `CleaningOptions` из `src/lib/cleaningEngine.ts`:

- **Базовая (`basic`)**: невидимые/нулевой ширины символы, кавычки/тире, нормализация пробелов.
- **Структура (`structure`)**: нормализация списков, удаление лишних пустых строк, подрезка хвостовых пробелов, опционально — `smart garbage cleanup` (декор/рамки/дубликаты строк/блоков).
- **AI‑паттерны (`aiPatterns`)**: поиск и (для части правил) замены/удаления. Также формируется список «подозрительных мест» для подсветки.
- **Humanizer (`humanizer`)**: микровариации (экспериментально). Может добавлять неочевидные изменения символов — используйте осознанно.

## Быстрый старт (разработка)

Требования: `Node.js >= 20`, `npm`.

```bash
npm ci
npm run dev
```

Откройте `http://localhost:5173`.

## Сборка и предпросмотр

```bash
npm run build
npm run preview
```

Сборка попадает в `dist/`.

## Docker (прод)

Сборка образа (внутри: сборка Vite → Nginx со SPA‑роутингом):

```bash
docker build -t antiai .
docker run --rm -p 8080:80 antiai
```

Откройте `http://localhost:8080`.

### Готовый образ из `antiai-amd64.tar`

В репозитории лежит экспорт Docker‑образа для `amd64` с тегом `antiai:amd64`:

```bash
docker load -i antiai-amd64.tar
docker run --rm -p 8080:80 antiai:amd64
```

На Apple Silicon/ARM может потребоваться эмуляция (`--platform=linux/amd64`) или пересборка образа локально.

## Развёртывание без Docker

1. Соберите проект: `npm run build` (получите `dist/`).
2. Раздайте `dist/` любым статическим хостингом со SPA‑fallback на `index.html`.

### Nginx

Готовый пример конфигурации лежит в `nginx.conf` (SPA‑роутинг через `try_files ... /index.html`, кэширование ассетов, `no-store` для `index.html`).

Если нужно развернуть приложение в подпути (например, `/antiai/`), настройте `base` для Vite (в `vite.config.ts` или через параметры сборки) и обновите пути на стороне сервера соответственно.

## Как это работает (в общих чертах)

- Алгоритм очистки: `src/lib/cleaningEngine.ts` (поэтапные преобразования + детектор паттернов + статистика).
- Список базовых AI‑паттернов: `src/lib/aiPatterns.ts` (включаемые/выключаемые правила; часть правил имеет `replacement`).
- Подсветка подозрительных мест в реальном времени: Web Worker `src/workers/aiDetectWorker.ts` (анализ отдельно от UI).
- `.docx`:
  - импорт → HTML/текст через `mammoth` (`src/lib/docxProcessor.ts`);
  - очистка HTML «по текстовым узлам» без потери тегов (`src/lib/htmlCleaner.ts`);
  - экспорт HTML/текста обратно в `.docx` через `docx` (`src/lib/docxProcessor.ts`).

## Использование

### Редактор

1. Вставьте текст или импортируйте `.docx`.
2. Нажмите «Очистить».
3. Переключайтесь между исходным/очищенным, смотрите diff и статистику.

Горячие клавиши:
- `F3` / `Shift+F3` — следующее/предыдущее подозрение.
- `Ctrl/Cmd+Enter` — очистка.
- `Ctrl/Cmd+S` — экспорт очищенного (если есть).
- `Ctrl/Cmd+Shift+L` — копировать очищенный текст.

### Пакетная обработка `.docx`

- Перетащите несколько файлов `.docx` и запустите обработку.
- После завершения скачайте все результаты одним `.zip`.

## Настройки и паттерны

- Основные уровни очистки включаются в разделе «Настройки».
- Детальные настройки управляют типографикой и дополнительными эвристиками (пробелы, тире/кавычки, удаление ссылок/емейлов/эмодзи, «smart garbage cleanup» и т.п.).
- Паттерны (включая пользовательские) можно переключать и дополнять в настройках. Состояние сохраняется в `localStorage` (ключ: `ai-text-purifier-storage`).
- Для снижения ложных срабатываний можно «игнорировать» конкретные найденные совпадения или целый паттерн (панель слева в редакторе).

### Пользовательские паттерны

В настройках можно добавить свой паттерн:

- **строка** (будет искаться как подстрока/слово);
- **regex** в формате `/.../flags`, например: `/\\bявляет(ся|тесь|ся)\\b/gi`.

Пользовательские паттерны сохраняются и отображаются как `custom-*`.

## LM Studio (опционально)

AntiAI может отправлять текст в локальный LM Studio (OpenAI‑совместимый HTTP API) для очистки/нормализации большими чанками.

Что нужно:
- Запущенный LM Studio server (обычно `http://localhost:1234`).
- Включённый CORS/доступ из браузера (иначе запросы будут блокироваться).

Настраивается в «Настройки → LM Studio»: `baseUrl`, `model`, размер чанка, параллелизм, system prompt.

Важно: при включении LM Studio текст будет отправляться на `baseUrl`, который вы указали (обычно `localhost`).

## Траблшутинг

- **LM Studio: запросы падают с CORS/Network error.** Включите доступ из браузера (CORS) в настройках сервера LM Studio и проверьте, что `baseUrl` открывается из браузера (`/v1/models`).
- **Импорт/экспорт `.docx` «теряет» оформление.** Приложение ориентировано на текст и базовую структуру (параграфы/заголовки/списки/таблицы); сложная верстка Word может конвертироваться упрощённо.
- **Большие документы тормозят.** Подсветка паттернов работает в фоне (worker), но рендер/редактирование всё равно упираются в размер документа; для очень больших текстов помогает LM Studio‑чанкинг или пакетный режим.

## Приватность и безопасность

- Без LM Studio приложение работает офлайн: текст обрабатывается в браузере, файлы `.docx` не уходят на сервер.
- С включённым LM Studio текст отправляется на `baseUrl`, который вы указали (обычно `localhost`).
- Паттерны — эвристика. Возможны ложные срабатывания; используйте игнорирование/отключение правил под ваш стиль.
- `Humanizer` может добавлять похожие символы (например, латинские `a/e/o` вместо кириллических) — это подходит не для всех сценариев.

## Структура проекта

- `src/lib/*` — движок очистки, паттерны, `.docx` и HTML‑обработка, LM Studio клиент.
- `src/pages/*` — страницы (редактор, пакетная обработка, настройки).
- `src/components/*` — UI и редакторы (TipTap).
- `src/store/useCleaningStore.ts` — Zustand‑хранилище + persist в `localStorage`.
- `src/workers/aiDetectWorker.ts` — анализ текста в фоне.

## Разработка

Полезные команды:

```bash
npm run dev      # дев‑сервер
npm run build    # сборка
npm run preview  # предпросмотр сборки
npm run lint     # eslint
```

## Вклад

- Баг‑репорты: приложите пример текста/фрагмента (без персональных данных) и ожидаемое поведение.
- Новые паттерны: добавляйте в `src/lib/aiPatterns.ts` (или как пользовательские через UI) и проверяйте на ложные срабатывания.
- Перед PR: `npm run lint` и `npm run build`.

#